{"meta":{"title":"dongdong devlog.","subtitle":"better than yesterday","description":"junior backend developer","author":"dongdong","url":"http://hoon-e.github.io","root":"/"},"pages":[{"title":"About","date":"2021-05-17T14:09:08.233Z","updated":"2021-05-17T14:09:08.233Z","comments":true,"path":"about/index.html","permalink":"http://hoon-e.github.io/about/index.html","excerpt":"","text":""},{"title":"all-archives","date":"2021-05-17T13:34:47.000Z","updated":"2021-05-17T13:37:56.663Z","comments":false,"path":"all-archives/index.html","permalink":"http://hoon-e.github.io/all-archives/index.html","excerpt":"","text":""},{"title":"all-tags","date":"2021-05-17T13:34:17.000Z","updated":"2021-05-17T13:34:35.152Z","comments":false,"path":"all-tags/index.html","permalink":"http://hoon-e.github.io/all-tags/index.html","excerpt":"","text":""},{"title":"all-categories","date":"2021-05-17T13:33:20.000Z","updated":"2021-05-17T13:33:45.213Z","comments":false,"path":"all-categories/index.html","permalink":"http://hoon-e.github.io/all-categories/index.html","excerpt":"","text":""}],"posts":[{"title":"HDFS Federation이란?","slug":"hdfs-federation","date":"2021-05-19T13:31:11.000Z","updated":"2021-05-19T15:14:55.581Z","comments":true,"path":"2021/05/19/hdfs-federation/","link":"","permalink":"http://hoon-e.github.io/2021/05/19/hdfs-federation/","excerpt":"","text":"나중에 사용할 수도 있을 것 같아 Hadoop3 버전부터 신규로 추가된 페더레이션 기능을 공부해보았다.Hadoop 공식 문서 중 HDFS Federation 부분을 번역한 내용이다. 배경 HDFS는 두 가지의 레이어를 가지고 있다. Namespace 디렉토리, 파일, 블록으로 구성되어 있다. 생성, 삭제, 변경, 파일과 디렉토리 나열과 같은 파일 시스템 작업들을 지원한다. Block Storage Service 블록 스토리지 서비스는 블록 관리와 저장소 두 가지로 분류 할 수 있다. 블록 관리(Block Management) - 네임 노드에서 수행된다. 등록 작업 및 주기적인 heartbeat를 체크하여, 데이터 노드들 간의 클러스터 멤버십을 제공한다. 블록 리포트를 처리하고 블록들의 위치를 유지한다. 생성, 삭제, 변경, 블록 위치 반환과 같은 블록 연관 작업을 지원한다. 복제본 배치, 덜 복제된 블록들의 복제 작업을 관리하고 초과로 복제된 블록들은 삭제한다. 저장소(Storage) 데이터 노드에 의해 제공된다. 로컬 파일 시스템에 블록을 저장하고 읽기/쓰기 접근을 허용한다. 이전의 HDFS 아키텍쳐에서는전체 클러스터에 단 하나의 네임스페이스만을 허용했다.이 구성에서는 단일 네임 노드가 네임 스페이스를 관리했다.HDFS 페더레이션은 HDFS에 여러 네임 노드 / 네임 스페이스에 대한 지원을 추가해서, 이러한 제약 조건을 해결하였다. 여러 개의 네임 노드 / 네임 스페이스HDFS 페더레이션에 대해 설명하면 다음과 같다. 여러 개의 네임 스페이스들을 수평적으로 확장하기 위해서 페더레이션에서는 여러개의 독립적인 네임 노드 / 네임 스페이스를 사용한다. 네임 노드들은 서로 연합된다. 네임 노드들은 서로 독립적이고, 서로 간의 코디네이션이 필요없다. 데이터 노드들은 모든 네임 노드들의 공통적인 저장소로서 사용된다. 각 데이터 노드는 클러스터 내의 모든 네임 노드들에 등록된다. 데이터 노드는 주기적인 heartbeat 및 블록 리포트를 전송하고, 네임 노드의 명령을 처리한다. 사용자는 ViewFs를 사용해서 개인화된 네임 스페이스 뷰를 만들 수 있다. Block Pool블록 풀은 단일 네임 스페이스에 속하는 블록들의 집합이다.데이터 노드는 클러스터의 모든 블록 풀에 대한 블록을 저장하게된다.각 블록 풀은 독립적으로 관리된다. 이를 통해서 네임 스페이스는 다른 네임 스페이스와 조정 없이 새롭게 생성되는 블록에 대한 블록 ID를 생성할 수 있다.특정 네임 노드에 장애가 발생하더라도, 데이터 노드가 클러스터 내의 다른 네임 노드와 동작하는 것에 영향을 주지 않는다. 네임 스페이스와 관련된 블록 풀을 묶어서 네임 스페이스 볼륨(Namespace volume) 이라고 부른다.네임 노드 / 네임 스페이스가 삭제되면, 데이터 노드의 해당 블록 풀들도 같이 사라진다.각 네임 스페이스 볼륨은 클러스터 업그레이드 시에 하나의 단위로서 업그레이드 된다. 클러스터 ID( cluster id )클러스터 ID 식별자는 클러스터의 모든 노드들을 식별하는 데에 사용된다.네임 노드 형식이 지정되면, 식별자가 제공되거나 자동으로 생성된다.이 ID는 다른 네임 노드들을 클러스터로 포함시키는데에 사용해야 한다. 그렇다면 HDFS 페더레이션을 하게되면 생기는 이점은 무엇일까 네임 스페이스 확장성(Namespace Scalability) 페더레이션은 네임 스페이스를 수평적으로 확장할 수 있도록 한다. 다수의 작은 파일을 사용하는 배포 혹은 대규모 배포에서 더 많은 네임 노드를 클러스터에 추가할 수 있도록 해서 이점을 얻을 수 있다. 성능(Performance) 클러스터에 여러 네임 노드가 추가되면 파일 시스템 읽기/쓰기 처리량이 늘어나게된다. 격리(Isolation) 하나의 네임 노드는 다중 사용자 환경에서 격리를 제공하지 못한다. 예를 들어 실험용 어플리케이션이 네임 노드에 부하를 주어, 실제로 프로덕션에서 중요한 작업이 느려지는 경우를 막을 수 있다. 이러한 경우 네임 노드에 부하가 가지 않도록 어플리케이션과 사용자의 범주를 네임스페이스 별로 따로 분리할 수 있다. 페더레이션 설정페더레이션 설정은 이전 버전과도 호환이 되고, 기존에 동작하던 단일 네임 노드 구성에 변경없이 동작할 수 있도록 지원한다.새 설정값은 클러스터 노드 유형에 따라서 다르게 배포할 필요없이, 클러스터의 모든 노드가 동일한 구성을 가지도록 설계되었다. 페더레이션은 새로운 nameserviceID 추상화를 추가한다.네임 노드와 연관되어있는 세컨더리, 백업, 체크포인터 노드들은 이 nameserviceId에 포함된다.단일 설정 파일을 지원하기 위해서, 네임 노드 및 세컨더리, 백업, 체크포인터 노드 설정 매개변수의 접미사로 nameserviceID가 사용된다. 설정하기step 1.dfs.nameservices 속성값을 설정파일에 추가하고, nameserviceId를 콤마로 구분하여 넣는다. 이 설정값은 데이터 노드들이 클러스터 내의 네임 노드들을 구분하는 데 사용된다. step 2.각 네임노드 및 세컨더리 네임노드, 백업 노드, 체크 포인터에 대해서 해당 nameserviceId 접미사가 붙은 속성값들을 설정 파일에 추가한다. 데몬 설정값 네임 노드 dfs.namenode.rpc-address dfs.namenode.servicerpc-address dfs.namenode.http-addressdfs.namenode.https-addressdfs.namenode.keytab.filedfs.namenode.name.dirdfs.namenode.edits.dirdfs.namenode.checkpoint.dirdfs.namenode.checkpoint.edits.dir 세컨더리 네임노드 dfs.namenode.secondary.http-addressdfs.secondary.namenode.keytab.file 백업 노드 dfs.namenode.backup.addressdfs.secondary.namenode.keytab.file 두 개의 네임 노드들의 설정값을 예로 들면 해당 속성값 뒤에 .namespaceId가 붙어있는 것을 확인할 수 있다. 12345678910111213141516&lt;configuration&gt; &lt;property&gt; &lt;name&gt;dfs.nameservices&lt;/name&gt; &lt;value&gt;ns1,ns2&lt;/value&gt; &lt;/property&gt; .. &lt;property&gt; &lt;name&gt;dfs.namenode.http-address.ns1&lt;/name&gt; &lt;value&gt;nn-host1:http-port&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.http-address.ns2&lt;/name&gt; &lt;value&gt;nn-host2:http-port&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; 동작하고 있는 HDFS 클러스터에 새로운 네임노드 추가하기 설정 파일에 dfs.nameservices 속성을 추가한다. nameserviceId 접미사로 설정을 업데이트한다. 설정 키 이름은 릴리스 0.20 이후 변경 되었으며 페더레이션을 사용하려면 새로운 설정 매개 변수 이름을 사용해야한다. 설정 파일에 새로운 네임노드 관련 속성값을 추가한다. 클러스터 내의 모든 노드들에 해당 설정파일을 적용한다. 새로운 네임 노드와 세컨 더리/백업 노드를 시작한다. 새롭게 추가된 네임 노드를 데이터 노드들에게 알리기 위해 모든 데이터 노드들에서 해당 커맨드를 실행시켜준다.1$HADOOP_HOME/bin/hdfs dfsadmin -refreshNamenodes &lt;datanode_host_name&gt;:&lt;datanode_ipc_port&gt; 문서 링크 : HDFS Federation","categories":[{"name":"big-data","slug":"big-data","permalink":"http://hoon-e.github.io/categories/big-data/"}],"tags":[{"name":"hadoop","slug":"hadoop","permalink":"http://hoon-e.github.io/tags/hadoop/"},{"name":"hdfs","slug":"hdfs","permalink":"http://hoon-e.github.io/tags/hdfs/"}]}],"categories":[{"name":"big-data","slug":"big-data","permalink":"http://hoon-e.github.io/categories/big-data/"}],"tags":[{"name":"hadoop","slug":"hadoop","permalink":"http://hoon-e.github.io/tags/hadoop/"},{"name":"hdfs","slug":"hdfs","permalink":"http://hoon-e.github.io/tags/hdfs/"}]}